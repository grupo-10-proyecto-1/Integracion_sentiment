events {}

http {
    upstream frontend {
        server sentiment-frontend:80;
    }

    upstream backend {
        server sentiment-backend:8080;
    }

    server {
        listen 80;

        location / {
            proxy_pass http://frontend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        location /api {
            # Rewrite /api/foo to /foo if the backend doesn't expect /api prefix
            # Assuming backend handles requests at root or we need to strip /api
            # For Spring Boot, usually we might need to strip it or configure context path.
            # Let's assume we strip it for now, or keep it if backend expects it.
            # Given the previous docker-compose, backend was at root.
            # Let's try passing it as is first, but often /api is a prefix.
            # If backend has context path /, then /api/users -> /users
            rewrite ^/api/(.*) /$1 break;
            proxy_pass http://backend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }
    }
}
